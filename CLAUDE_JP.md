# CLAUDE.md (日本語版)

このファイルは、Claude Code (claude.ai/code) がこのリポジトリのコードを操作する際のガイダンスを提供します。

## プロジェクト概要

MindTravel3Dは、Three.jsで構築されたWebベースの3D迷路ゲームです。複数のプラットフォーム（PC、モバイル、タブレット）で没入感のある3D迷路探索体験を提供するプログレッシブWebアプリ（PWA）です。3D迷路の楽しさを理解してくれる1000万ユーザーの獲得を目標としています。

## 開発コマンド

### ローカル開発
```bash
# ローカルサーバー起動（Python）
python3 -m http.server 8000

# Node.jsを使用する場合
npx serve

# ゲームにアクセス
open http://localhost:8000
```

### テスト
- 現在、自動テストフレームワークは実装されていません
- 異なるビューポートサイズでのブラウザでの手動テスト
- Ctrl+Dでランタイム検証用のデバッグパネルが利用可能

### デプロイ
- 静的サイトホスティング（現在はGitHub Pages）
- ビルドプロセスは不要 - 直接ファイルデプロイ
- PWAアセット（manifest.json、sw.js）は手動メンテナンス

## アーキテクチャ概要

### コアコンポーネント

**GameManager (js/main.js)**
- すべてのシステムを初期化・調整する中央オーケストレーター
- エラー管理とPWAセットアップを担当
- ゲームライフサイクル（開始、新迷路生成）を管理

**GameEngine (js/game-engine.js)**
- Three.jsを使用した3Dレンダリングエンジン
- シーン管理（ライト、カメラ、マテリアル）
- プレイヤーの移動と衝突判定
- 迷路生成の視覚化とゴール機能

**MazeGenerator (js/maze-generator.js)**
- 再帰バックトラッキングアルゴリズムを実装
- 50×50迷路グリッドを生成
- スタート/エンド位置の計算を提供

**Controls (js/controls.js)**
- キーボード、マウス、タッチの入力処理
- クロスプラットフォーム制御抽象化
- 移動と回転コマンド

**UIManager (js/ui-manager.js)**
- UI状態管理（メニュー、モーダル、ゲーム情報）
- モバイル制御インターフェース
- エラー表示とローディング状態

**ThreeCompatibility (js/three-compatibility.js)**
- Three.js APIの違いに対応する互換性レイヤー
- ジオメトリとマテリアル作成を適切に処理
- 不足しているThree.js機能のフォールバックを提供

### 主要な技術パターン

**動的スクリプトローディング**
- Three.jsを最初に読み込み、その後依存スクリプトを順次読み込み
- キャッシュバスティング用のバージョンパラメータ（`?v=2025-08-01-upgraded`）
- ローカルThree.jsが失敗した場合のCDNへの適切なフォールバック

**エラーハンドリング**
- 初期化での包括的なエラーキャッチ
- 未処理例外用のグローバルエラーハンドラー
- UIManager経由でのユーザーフレンドリーなエラーメッセージ

**3Dシーンアーキテクチャ**
- canvasを使用したプロシージャルテクスチャ生成
- プレイヤースポットライトを含む強化された照明システム
- 迷路の壁/床用の最適化されたジオメトリ再利用

**PWA実装**
- オフライン機能用のService Worker
- インストール可能性のためのアプリマニフェスト
- クロスプラットフォームタッチコントロール

## ファイル構造
```
MindTravel3D/
├── index.html              # 埋め込みCSS/JSを含むメインHTML
├── manifest.json           # PWAマニフェスト
├── sw.js                   # Service Worker
├── three.min.js            # Three.jsライブラリ（ローカルコピー）
├── js/
│   ├── main.js             # GameManager - 中央コーディネーター
│   ├── game-engine.js      # 3Dエンジンとレンダリング
│   ├── maze-generator.js   # 迷路生成アルゴリズム
│   ├── controls.js         # 入力処理システム
│   ├── ui-manager.js       # UI状態管理
│   └── three-compatibility.js # Three.js互換性レイヤー
└── docs/                   # プロジェクトドキュメント
    ├── README.md
    └── requirements-phase1.md # 詳細なプロジェクト要件
```

## 開発ガイドライン

### Three.js統合
- 利用可能な場合は常に互換性レイヤー（window.ThreeCompat）を使用
- try-catchブロックでジオメトリ/マテリアル作成をテスト
- 互換性レイヤーが失敗した場合は基本的なThree.jsコンストラクターにフォールバック

### モバイル対応
- モバイルデバイスでタッチコントロールが自動的に有効化
- 小さな画面用にUIを適応させるレスポンシブデザイン
- 低性能デバイス用のパフォーマンス最適化

### デバッグ
- Ctrl+Dキーボードショートカットでデバッグパネルが利用可能
- レンダリング、メモリ使用量、パフォーマンスをテストする検証システム
- エラーハンドリングパスをテストするためのエラーシミュレーションツール

### コードスタイル
- ソースコード内の日本語コメント（プロジェクトは日本向け）
- ES6+機能を全体で使用
- 初期化シーケンス用のasync/awaitパターン

### パフォーマンス目標
- 60fpsレンダリング目標
- 3秒初回ロード時間目標
- 500MBメモリ使用量制限
- 基本的なWebGL機能を持つデバイスをサポート

## 一般的な開発タスク

### 新しい迷路機能の追加
1. 新しいアルゴリズム用にMazeGeneratorクラスを修正
2. 視覚的表現のためにGameEngine.createMaze()を更新
3. 異なるデバイスとブラウザでテスト

### 3Dグラフィックスの強化
1. 新しいジオメトリ/マテリアル用にThreeCompatibilityレイヤーを使用
2. Three.js機能が利用できない場合のフォールバック動作をテスト
3. モバイルデバイスでのパフォーマンスを検証

### UI/コントロールの改善
1. 新しいインターフェース要素用にUIManagerを更新
2. 新しい入力方法用にControlsクラスを拡張
3. 画面サイズ全体でのレスポンシブ動作をテスト

### PWA強化
1. 新しい機能用にmanifest.jsonを更新
2. 追加のオフライン機能用にsw.jsを修正
3. インストールとオフライン機能をテスト

## プロジェクトの現状

プロジェクトは現在MVP段階にあり、強化されたビジュアル、ソーシャル機能、バックエンドインフラストラクチャを通じて100万ユーザーをターゲットとする第1段階を計画しています。

### MVP完了機能
- 基本的な3D迷路ゲーム
- マルチプラットフォーム対応
- PWA機能
- 迷路生成アルゴリズム

### 第1段階計画（6ヶ月、100万ユーザー目標）
- ビジュアル強化（テクスチャ、ライティング、エフェクト）
- ゲームプレイ拡張（難易度設定、新モード）
- ソーシャル機能（ランキング、フレンド機能）
- バックエンド構築（ユーザー管理、スコア管理）

このプロジェクトは、Web技術を使用した3D迷路体験の可能性を追求し、最終的に1000万ユーザーに3D迷路の楽しさを届けることを目指しています。